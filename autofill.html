<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Autofill</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="autofill.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Indie+Flower|Lobster"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Noto+Sans+HK:wght@100;300;400;500;700;900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
    />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://kit.fontawesome.com/147b2895a5.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body id="body">
    <div id="line1">
      設定:
      <p style="display: inline-block" id="fullNotfull"></p>
      ,
      <p style="display: inline-block" id="passZhuang"></p>
    </div>

    <div id="line2">應付金額(每位)</div>

    <table id="fanshuWinloss">
      <thead>
        <tr>
          <th id="th1" class="th">番數</th>
          <th id="th2" class="th">自摸</th>
          <th id="th3" class="th">出冲玩家</th>
          <th id="th4" class="th">非出冲玩家</th>
        </tr>
      </thead>

      <tbody></tbody>
    </table>

    <div id="buttonDiv">
      <button class="button" type="button" onclick="confirm()">確認</button>
      <button
        type="button"
        class="button"
        id="backButton"
        onclick="window.history.back()"
      >
        回到上一頁
      </button>
      <button
        type="button"
        class="button"
        id="homeButton"
        onclick="window.location.href='index.html'"
      >
        回到主頁
      </button>
    </div>

    <!-- <div id="copyrightDiv">
      <p>
        &copy; <span id="copyright"></span> bigeyedog.studio All rights
        reserved.
      </p>
    </div> -->

    <!-- <script>
      const startYear = 2025; // Replace with your starting year
      const currentYear = new Date().getFullYear();
      const copyrightText =
        startYear === currentYear
          ? currentYear
          : `${startYear} - ${currentYear}`;
      document.getElementById("copyright").textContent = copyrightText;
    </script> -->

    <script>
      const smallestfan = sessionStorage.getItem("smallestfan");
      const biggestfan = sessionStorage.getItem("biggestfan");
      const fullNotfull = sessionStorage.getItem("fullNotfull");
      const passZhuang = sessionStorage.getItem("passZhuang");
      const customFSArray = JSON.parse(sessionStorage.getItem("customFSArray"));
      const zimoArray = JSON.parse(sessionStorage.getItem("zimoArray"));
      const cc0Array = JSON.parse(sessionStorage.getItem("cc0Array"));
      const cc1Array = JSON.parse(sessionStorage.getItem("cc1Array"));
      const cc2Array = JSON.parse(sessionStorage.getItem("cc2Array"));
      const cc3Array = JSON.parse(sessionStorage.getItem("cc3Array"));
      const numberOfPlayers = JSON.parse(
        sessionStorage.getItem("numberOfPlayers")
      );
      console.log(
        smallestfan,
        biggestfan,
        customFSArray,
        zimoArray,
        cc0Array,
        cc1Array,
        cc2Array,
        cc3Array,
        fullNotfull,
        passZhuang
      );
    </script>

    <script>
      const fsLength = customFSArray.length;

      for (let i = 0; i < fsLength; i++) {
        // Create a new table row each iteration
        const $row = $("<tr></tr>");

        // Create and append the "番数" cell
        const $fanshu = $("<td></td>")
          .text(customFSArray[i])
          .css("white-space", "nowrap");

        // Create and append the input cell
        const $zimo = $("<td></td>");
        const zimoID = "zimo" + customFSArray[i];
        const $zimoInput = $("<input>")
          .attr("class", "zimoInput")
          .attr("id", zimoID)
          .attr("type", "number")
          .attr("min", 0)
          .attr("step", 0.1)
          .attr("required", true)
          .attr("readonly", true)
          .attr("value", Number(zimoArray[i]));
        $zimo.append($zimoInput);

        const $cc0 = $("<td></td>");
        const cc0ID = "cc0" + customFSArray[i];
        const $cc0Input = $("<input>")
          .attr("class", "cc0Input")
          .attr("id", cc0ID)
          .attr("type", "number")
          .attr("min", 0)
          .attr("step", 0.1)
          .attr("required", true)
          .attr("readonly", true)
          .attr("value", cc0Array[i]);
        $cc0.append($cc0Input);

        const $cc1 = $("<td></td>");
        const cc1ID = "cc1" + customFSArray[i];
        const $cc1Input = $("<input>")
          .attr("class", "cc1Input")
          .attr("id", cc1ID)
          .attr("type", "number")
          .attr("min", 0)
          .attr("step", 0.1)
          .attr("required", true)
          .attr("readonly", true)
          .attr("value", cc1Array[i]);
        $cc1.append($cc1Input);

        const $cc2 = $("<td></td>");
        const cc2ID = "cc2" + customFSArray[i];
        const $cc2Input = $("<input>")
          .attr("class", "cc2Input")
          .attr("id", cc2ID)
          .attr("type", "number")
          .attr("min", 0)
          .attr("step", 0.1)
          .attr("required", true)
          .attr("readonly", true)
          .attr("value", cc2Array[i]);
        $cc2.append($cc2Input);

        const $cc3 = $("<td></td>");
        const cc3ID = "cc3" + customFSArray[i];
        const $cc3Input = $("<input>")
          .attr("class", "cc3Input")
          .attr("id", cc3ID)
          .attr("type", "number")
          .attr("min", 0)
          .attr("step", 0.1)
          .attr("required", true)
          .attr("readonly", true)
          .attr("value", cc3Array[i]);
        $cc3.append($cc3Input);

        // Append cells to the row
        if (fullNotfull === "全銃") {
          $row.append($fanshu).append($zimo).append($cc1).append($cc0);
        } else if (fullNotfull === "半銃") {
          $row.append($fanshu).append($zimo).append($cc2).append($cc3);
        }
        $("#fanshuWinloss tbody").append($row);
      }

      const zerofanID = "#zimo" + customFSArray[0];
      if (smallestfan === 0) {
        $(zerofanID).val(0);
        $(zerofanID).attr("readonly", true);
      }

      $("#fullNotfull").text(fullNotfull);
      $("#passZhuang").text(passZhuang);
    </script>

    <script>
      // function enableEditing() {
      //   $(".zimoInput, .cc0Input, .cc1Input, .cc2Input, .cc3Input").prop(
      //     "readonly",
      //     false
      //   );
      //   $("#zimo雞糊").prop("readonly", true);
      //   let editableCells = document.querySelectorAll(
      //     ".zimoInput, .cc0Input, .cc1Input, .cc2Input, .cc3Input"
      //   );

      //   editableCells.forEach((cell) => {
      //     // // Make the cell editable and apply the visual effect
      //     // if (!cell.isContentEditable) {
      //     //     cell.contentEditable = true; // Make editable
      //     cell.classList.add("editable-border"); // Apply the border and background color
      //     // }
      //   });
      // }

      function confirm() {
        const finalzimoArray = [];
        const finalcc0Array = [];
        const finalcc1Array = [];
        const finalcc2Array = [];
        const finalcc3Array = [];

        for (let i = 0; i < fsLength; i++) {
          if (fullNotfull === "全銃") {
            const zimoID = "#zimo" + customFSArray[i];
            const cc0ID = "#cc0" + customFSArray[i];
            const cc1ID = "#cc1" + customFSArray[i];
            finalzimoArray.push(Number($(zimoID).val()));
            finalcc0Array.push(Number($(cc0ID).val()));
            finalcc1Array.push(Number($(cc1ID).val()));
            sessionStorage.setItem(
              "finalzimoArray",
              JSON.stringify(finalzimoArray)
            );
            sessionStorage.setItem(
              "finalcc0Array",
              JSON.stringify(finalcc0Array)
            );
            sessionStorage.setItem(
              "finalcc1Array",
              JSON.stringify(finalcc1Array)
            );
            sessionStorage.setItem("finalcc2Array", JSON.stringify(cc2Array));
            sessionStorage.setItem("finalcc3Array", JSON.stringify(cc3Array));
          } else if (fullNotfull === "半銃") {
            const zimoID = "#zimo" + customFSArray[i];
            const cc2ID = "#cc2" + customFSArray[i];
            const cc3ID = "#cc3" + customFSArray[i];
            finalzimoArray.push(Number($(zimoID).val()));
            finalcc2Array.push(Number($(cc2ID).val()));
            finalcc3Array.push(Number($(cc3ID).val()));
            sessionStorage.setItem(
              "finalzimoArray",
              JSON.stringify(finalzimoArray)
            );
            sessionStorage.setItem("finalcc0Array", JSON.stringify(cc0Array));
            sessionStorage.setItem("finalcc1Array", JSON.stringify(cc1Array));
            sessionStorage.setItem(
              "finalcc2Array",
              JSON.stringify(finalcc2Array)
            );
            sessionStorage.setItem(
              "finalcc3Array",
              JSON.stringify(finalcc3Array)
            );
          }
        }

        const numberOfPlayers = sessionStorage.getItem("numberOfPlayers");
        console.log(numberOfPlayers);
        if (numberOfPlayers === "3") {
          window.location.href = "position3.html";
        } else if (numberOfPlayers === "4") {
          window.location.href = "position4.html";
        }
      }
    </script>
  </body>
</html>
